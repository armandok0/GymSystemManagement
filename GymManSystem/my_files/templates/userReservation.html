<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Reservations</title>
    <link rel="stylesheet" type="text/css" href="/static/stylesheet.css" />
    <style>
      .content {
        max-width: 1100px;
        margin: 0 auto;
        padding: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
      }

      header {
        text-align: center;
        font-weight: bolder;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
        font-size: xx-large;
        color: aliceblue;
        margin-top: 30px;
        margin-bottom: 30px;
      }

      h3 {
        text-align: center;
        color: #f9dc5c;
        margin-top: 15px;
      }

      .reservation-box {
        border: 1px solid #f0803c;
        border-radius: 5px;
        padding: 10px;
        margin: 10px auto;
        background-color: #020202;
        color: aliceblue;
        width: 400px;
      }

      .reservation-box h3,
      .reservation-box p {
        margin: 0;
      }

      .cancel-button {
        display: block;
        margin-top: 15px;
        background-color: red;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
      }

      .cancel-button:hover {
        background-color: darkred;
      }
    </style>
  </head>
  <body>
    <div class="content">
      <nav class="navbar">
        <div class="logo">
          <img src="/static/logo.png" alt="Logo" />
          <h1>Peak Performance Gym</h1>
        </div>
        {% if userHTML == 'admin' %}
        <ul>
          <li><a href="/homeHTML">Home</a></li>
          <li>
            <a href="/pendingUsersHTML">Manage Registrations</a>
          </li>
          <li><a href="/crudUsersHTML">Manage Users</a></li>
          <li><a href="/crudServicesHTML">Manage Products & Services</a></li>
          <li><a href="/crudAnnouncementsHTML">Manage Announcements</a></li>
          <li><a href="/logout">Log Out</a></li>
        </ul>
        {% elif userHTML == 'user' %}
        <ul>
          <li><a href="/homeHTML">Home</a></li>
          <li><a href="/servicesHTML">Products & Services</a></li>
          <li><a href="/checkAvailabilityHTML">Book Reservations</a></li>
          <li>
            <a class="active" href="/userReservationHTML"
              >Reservation History</a
            >
          </li>
          <li><a href="/announcementsHTML">Announcements</a></li>
          <li><a href="/logout">Log Out</a></li>
        </ul>
        {% else %}
        <ul>
          <li><a href="/homeHTML">Home</a></li>
          <li><a href="/servicesHTML">Products & Services</a></li>
          <li><a href="/announcementsHTML">Announcements</a></li>
          <li><a href="/loginHTML">Register / Log In</a></li>
        </ul>
        {% endif %}
      </nav>

      <div id="userReservations"></div>

      <script>
        // Function to cancel a reservation
        function cancelReservation(reservationId) {
          if (confirm("Are you sure you want to cancel this reservation?")) {
            fetch("/cancelReservation/" + reservationId, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then((response) => response.json())
              .then((data) => {
                alert(data.message);
                // Reload the page after cancellation
                location.reload();
              })
              .catch((error) => console.error("Error:", error));
          }
        }

        // Fetch user reservations from the server
        fetch("/userReservations", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            var userReservationsHTML = "";
            if (data.message) {
              userReservationsHTML += "<p>" + data.message + "</p>";
            } else {
              data.forEach(function (reservation, index) {
                var date = new Date(reservation.service_details.date);
                var formattedDate = date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                });
                userReservationsHTML +=
                  "<div class='reservation-box'><h3>Reservation " +
                  (index + 1) +
                  ":</h3><p>Activity: " +
                  reservation.service_details.name +
                  "<br>Type: " +
                  reservation.service_details.service_type +
                  "<br>Date: " +
                  (formattedDate || "Not specified") +
                  "<br>Time: " +
                  reservation.service_details.time +
                  "<br>Trainer: " +
                  reservation.service_details.trainer_surname +
                  "</p><button class='cancel-button' onclick='cancelReservation(\"" +
                  reservation._id +
                  "\")'>Cancel Reservation</button></div><br>";
              });
            }
            document.getElementById("userReservations").innerHTML =
              userReservationsHTML;
          })
          .catch((error) => console.error("Error:", error));
      </script>
    </div>
  </body>
</html>
